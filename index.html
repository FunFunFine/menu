<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Меню недели</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #fafafa;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background: #4CAF50;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        main {
            flex: 1;
            padding: 1rem;
        }

        section {
            margin-bottom: 2rem;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            cursor: pointer;
            border-radius: 5px;
            font-size: 1rem;
        }

        button:hover {
            background: #45a049;
        }

        input, select {
            margin: 0.5rem;
            padding: 0.4rem;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 0.5rem 0;
            padding: 0.8rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        footer {
            text-align: center;
            padding: 1rem;
            background: #eee;
        }

        #foodList {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .category-group {
            margin-bottom: 2rem;
        }

        .category-title {
            grid-column: 1 / -1; /* Make titles span full width */
            font-size: 1.2rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: #4CAF50;
            border-bottom: 2px solid #ddd;
            padding-bottom: 0.3rem;
        }

    </style>
</head>
<body>
<header>
    <h1>Меню недели</h1>
</header>

<main>
    <section id="controls">
        <h2>Сгенерировать меню</h2>
        <label>
            Кол-во блюд:
            <input type="number" id="count" value="5" min="1" max="20">
        </label>
        <label>
            Обязательный ингредиент:
            <input type="text" id="mustInclude" placeholder="например: курица">
        </label>
        <button onclick="generateMenu()">Сгенерировать</button>
        <div id="menuResult"></div>
    </section>

    <section id="allFood">
        <h2>Все блюда</h2>
        <div id="foodList"></div>
    </section>
</main>

<footer>
    <small>Меню недели — GitHub Pages</small>
</footer>

<script>
    let foodData = [];

    function normalize(str) {
        return str.toLowerCase().trim();
    }

    fetch("food.json")
        .then(res => res.json())
        .then(data => {
            foodData = data.map(item => ({
                ...item,
                name: normalize(item.name),
                description: item.description,
                category: item.category,
                ingredients: item.ingredients.map(normalize)
            }));
            renderAllFood();
        });

    // ✅ Group by category
    function renderAllFood() {
        const container = document.getElementById("foodList");
        container.innerHTML = "";

        // Group dishes by category
        const groups = {};
        foodData.forEach(item => {
            if (!groups[item.category]) groups[item.category] = [];
            groups[item.category].push(item);
        });

        // Render each category
        Object.keys(groups).forEach(cat => {
            const section = document.createElement("div");
            section.className = "category-group";

            const title = document.createElement("div");
            title.className = "category-title";
            title.textContent = cat;
            section.appendChild(title);

            // Card grid
            const grid = document.createElement("div");
            grid.style.display = "grid";
            grid.style.gridTemplateColumns = "repeat(auto-fit, minmax(250px, 1fr))";
            grid.style.gap = "1rem";

            groups[cat].forEach(item => {
                const div = document.createElement("div");
                div.className = "card";
                div.innerHTML = `<strong>${item.name}</strong><br>
        ${item.description || ""}<br>
        <small>Ингредиенты: ${item.ingredients.join(", ")}</small>`;
                grid.appendChild(div);
            });

            section.appendChild(grid);
            container.appendChild(section);
        });
    }

    function generateMenu() {
        const count = parseInt(document.getElementById("count").value) || 5;
        const mustInclude = normalize(document.getElementById("mustInclude").value);

        let filtered = foodData;
        if (mustInclude) {
            filtered = foodData.filter(item =>
                item.ingredients.some(ing => ing.includes(mustInclude))
            );
        }

        const shuffled = [...filtered].sort(() => 0.5 - Math.random());
        const selected = shuffled.slice(0, count);

        const allIngredients = [...new Set(selected.flatMap(i => i.ingredients))];

        const resultDiv = document.getElementById("menuResult");
        resultDiv.innerHTML = "";

        // Title
        const title = document.createElement("h3");
        title.textContent = "Ваше меню:";
        resultDiv.appendChild(title);

        // ✅ Cards in a grid
        const grid = document.createElement("div");
        grid.style.display = "grid";
        grid.style.gridTemplateColumns = "repeat(auto-fit, minmax(250px, 1fr))";
        grid.style.gap = "1rem";

        selected.forEach(i => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `<strong>${i.name}</strong><br>
      <small>Ингредиенты: ${i.ingredients.join(", ")}</small>`;
            grid.appendChild(card);
        });

        resultDiv.appendChild(grid);

        // Ingredients summary
        const ingredientsTitle = document.createElement("h4");
        ingredientsTitle.textContent = "Список ингредиентов:";
        resultDiv.appendChild(ingredientsTitle);

        const ingCard = document.createElement("div");
        ingCard.className = "card";
        ingCard.textContent = allIngredients.join(", ");
        resultDiv.appendChild(ingCard);
    }
</script>

</body>
</html>
