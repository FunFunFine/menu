<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–µ–Ω—é –Ω–µ–¥–µ–ª–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #fafafa;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background: #4CAF50;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        main {
            flex: 1;
            padding: 1rem;
        }

        section {
            margin-bottom: 2rem;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            cursor: pointer;
            border-radius: 8px;
            font-size: 1rem;
        }

        button:hover {
            background: #45a049;
        }

        input, select {
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-radius: 6px;
            border: 1px solid #ccc;
            width: 100%;
            max-width: 300px;
            font-size: 1rem;
        }

        .card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 0.8rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            transition: transform 0.1s ease-in-out;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        #foodList, #menuResult .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0.8rem;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            margin-top: 0.5rem;
            gap: 0.5rem;
        }

        .tag {
            background: #e0f5e0;
            color: #2c662d;
            border: 1px solid #4CAF50;
            border-radius: 15px;
            padding: 0.2rem 0.6rem;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .tag button {
            background: none;
            border: none;
            color: #2c662d;
            font-weight: bold;
            cursor: pointer;
        }

        /* ‚úÖ Mobile adjustments */
        @media (max-width: 600px) {
            header h1 {
                font-size: 1.4rem;
            }

            main {
                padding: 0.5rem;
            }

            section h2 {
                font-size: 1.1rem;
            }

            button {
                width: 100%;
                margin-top: 0.5rem;
            }

            #foodList, #menuResult .grid {
                grid-template-columns: 1fr; /* single column on small screens */
            }

            .card {
                font-size: 0.95rem;
                padding: 0.7rem;
            }
        }
    </style>
</head>
<body>
<header>
    <h1>–ú–µ–Ω—é –Ω–µ–¥–µ–ª–∏</h1>
</header>

<main>
    <section id="controls">
        <h2>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é</h2>
        <label>
            –ö–æ–ª-–≤–æ –±–ª—é–¥:
            <input type="number" id="count" value="5" min="1" max="20">
        </label>
        <br>

        <label>–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</label><br>
        <select id="ingredientSelect">
            <option value="">-- –≤—ã–±–µ—Ä–∏—Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç --</option>
        </select>
        <div id="selectedIngredients" class="tags"></div>

        <br>
        <button onclick="generateMenu()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
        <div id="menuResult"></div>
    </section>


    <section id="allFood">
        <h2>–í—Å–µ –±–ª—é–¥–∞</h2>
        <div id="foodList"></div>
    </section>
</main>

<footer>
    <small>–ú–µ–Ω—é –Ω–µ–¥–µ–ª–∏</small>
</footer>

<script>

    let foodData = [];
    let allIngredientsSet = new Set();
    let selectedIngredients = [];
    let lockedDishes = [];          // names of locked dishes
    let currentSelection = [];      // current generated dishes

    function normalize(str) {
        return str.toLowerCase().trim();
    }

    fetch("food.json")
        .then(res => res.json())
        .then(data => {
            foodData = data.map(item => ({
                ...item,
                name: normalize(item.name),
                description: item.description,
                category: item.category,
                ingredients: item.ingredients.map(normalize)
            }));

            foodData.forEach(item => item.ingredients.forEach(ing => allIngredientsSet.add(ing)));
            populateIngredientDropdown();
            renderAllFood();
        });

    // Dropdown population
    function populateIngredientDropdown() {
        const select = document.getElementById("ingredientSelect");
        Array.from(allIngredientsSet).sort().forEach(ing => {
            const option = document.createElement("option");
            option.value = ing;
            option.textContent = ing;
            select.appendChild(option);
        });

        select.addEventListener("change", () => {
            const val = select.value;
            if (val && !selectedIngredients.includes(val)) {
                selectedIngredients.push(val);
                renderSelectedTags();
            }
            select.value = "";
        });
    }

    function renderSelectedTags() {
        const container = document.getElementById("selectedIngredients");
        container.innerHTML = "";
        selectedIngredients.forEach(ing => {
            const tag = document.createElement("div");
            tag.className = "tag";
            tag.innerHTML = `${ing} <button onclick="removeIngredient('${ing}')">&times;</button>`;
            container.appendChild(tag);
        });
    }

    function removeIngredient(ing) {
        selectedIngredients = selectedIngredients.filter(i => i !== ing);
        renderSelectedTags();
    }

    // ‚úÖ Toggle lock/unlock without regenerating
    function toggleLock(dishName) {
        if (lockedDishes.includes(dishName)) {
            lockedDishes = lockedDishes.filter(d => d !== dishName);
        } else {
            lockedDishes.push(dishName);
        }
        renderMenuCards(); // just re-render UI with updated lock state
    }

    // Generate menu (create currentSelection)
    function generateMenu() {
        const count = parseInt(document.getElementById("count").value) || 5;

        let filtered = foodData;
        if (selectedIngredients.length > 0) {
            filtered = foodData.filter(item =>
                selectedIngredients.every(ing => item.ingredients.includes(ing))
            );
        }

        // Keep locked dishes
        const locked = foodData.filter(i => lockedDishes.includes(i.name));

        // Fill remaining slots
        const remainingCount = count - locked.length;
        const pool = filtered.filter(i => !lockedDishes.includes(i.name));
        const shuffled = [...pool].sort(() => 0.5 - Math.random());
        const newOnes = shuffled.slice(0, remainingCount);

        // ‚úÖ Save current selection
        currentSelection = [...locked, ...newOnes];

        renderMenuCards();
    }

    // Render currentSelection with lock states
    function renderMenuCards() {
        const resultDiv = document.getElementById("menuResult");
        resultDiv.innerHTML = "";

        const title = document.createElement("h3");
        title.textContent = "–í–∞—à–µ –º–µ–Ω—é:";
        resultDiv.appendChild(title);

        const grid = document.createElement("div");
        grid.className = "grid"; // ‚úÖ so CSS applies
        resultDiv.appendChild(grid);

        currentSelection.forEach(i => {
            const card = document.createElement("div");
            card.className = "card";

            const isLocked = lockedDishes.includes(i.name);

            card.innerHTML = `
      <strong>${i.name}</strong><br>
      <small>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã: ${i.ingredients.join(", ")}</small><br>
      <button onclick="toggleLock('${i.name}')">
        ${isLocked ? "üîí –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ" : "üîì –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å"}
      </button>
    `;

            if (isLocked) {
                card.style.border = "2px solid #4CAF50";
                card.style.background = "#f0fff0";
            }

            grid.appendChild(card);
        });

        const allIngredients = [...new Set(currentSelection.flatMap(i => i.ingredients))];
        const ingredientsTitle = document.createElement("h4");
        ingredientsTitle.textContent = "–°–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤:";
        resultDiv.appendChild(ingredientsTitle);

        const ingredientsCard = document.createElement("div");
        ingredientsCard.className = "card";
        ingredientsCard.textContent = allIngredients.join(", ");
        resultDiv.appendChild(ingredientsCard);
    }


    // ‚úÖ Group by category
    function renderAllFood() {
        const container = document.getElementById("foodList");
        container.innerHTML = "";

        // Group dishes by category
        const groups = {};
        foodData.forEach(item => {
            if (!groups[item.category]) groups[item.category] = [];
            groups[item.category].push(item);
        });

        // Render each category
        Object.keys(groups).forEach(cat => {
            const section = document.createElement("div");
            section.className = "category-group";

            const title = document.createElement("div");
            title.className = "category-title";
            title.textContent = cat;
            section.appendChild(title);

            // Card grid
            const grid = document.createElement("div");
            grid.style.display = "grid";
            grid.style.gridTemplateColumns = "repeat(auto-fit, minmax(250px, 1fr))";
            grid.style.gap = "1rem";

            groups[cat].forEach(item => {
                const div = document.createElement("div");
                div.className = "card";
                div.innerHTML = `<strong>${item.name}</strong><br>
        ${item.description || ""}<br>
        <small>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã: ${item.ingredients.join(", ")}</small>`;
                grid.appendChild(div);
            });

            section.appendChild(grid);
            container.appendChild(section);
        });
    }

</script>

</body>
</html>
